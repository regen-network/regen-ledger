# Regen Network DevNet Setup Guide

This README provides step-by-step instructions for setting up a multi-node Regen Network development network (DevNet) using Docker Compose. This guide aims to help developers quickly spin up a local Regen Network for testing and development purposes.


## Prerequisites
Before starting, ensure you have the following installed on your machine:

* **Docker:** Download and install Docker
* **Docker Compose:** Download and install Docker Compose
* **Git:** Download and install Git
* **jq:** Command-line JSON processor (Install Guide)

## Usage
```shell
chmod +x setup.sh
./setup.sh
```
**Note:** The script will clean up any existing data to ensure a fresh start.

## Interacting with the network
Once the nodes are running, you can interact with them using regen CLI commands.

For example, to query the status of the first node:

```shell
regen status --node http://localhost:26657
```

Replace 26657 with the appropriate RPC port if interacting with other nodes (26659, 26661).


## File Structure
```text
├── Dockerfile # Defines the Docker image used for the Regen nodes.
├── docker-compose.yml # Docker Compose configuration for the three nodes.
├── entrypoint.sh # Entry script executed inside each Docker container to initialize and start the node.
├── setup.sh #  Script to generate keys, write environment variables, and start the network.
└── shared/ # Shared directory for nodes to exchange files (e.g., genesis files, gentxs).

```

## Scripts Overview
### `setup.sh`
This script automates the initial setup:

1. **Generates Validator Keys:** Creates keys for each node and extracts their addresses and mnemonics.
2. **Writes .env File:** Stores the addresses and mnemonics as environment variables.
3. **Starts Docker Compose:** Brings up the network with all three nodes.

### `entrypoint.sh`
Executed inside each Docker container, this script:

1. Initializes the node if it's not already initialized.
2. Imports the validator key using the mnemonic.
3. Generates the gentx file.
4. Coordinates with other nodes to collect gentx files and finalize the genesis file.
5. Configures persistent peers and starts the node.

#### Key Features:

**Synchronization Mechanisms:** Ensures nodes wait for each other during initialization.

### `docker-compose.yml`
Defines the Docker services for the three nodes.

Services:
* regen-node1
* regen-node2
* regen-node3


#### Configurations:

* **Environment Variables:** Loaded from the .env file.
* **Ports:** Exposes RPC and P2P ports for each node.
* **Volumes:** Mounts the shared directory and entrypoint.sh script.
* **Networks:** All nodes are on the same Docker network for internal communication.
* **.env File**: Automatically generated by setup.sh, this file contains validator addresses and mnemonics for all nodes.
Example Contents:

```
REGEN_NODE1_VALIDATOR_ADDRESS=regen1...
REGEN_NODE1_VALIDATOR_MNEMONIC="mnemonic words ..."
REGEN_NODE2_VALIDATOR_ADDRESS=regen1...
REGEN_NODE2_VALIDATOR_MNEMONIC="mnemonic words ..."
REGEN_NODE3_VALIDATOR_ADDRESS=regen1...
REGEN_NODE3_VALIDATOR_MNEMONIC="mnemonic words ..."
```

# State Initialization
For state initialization we recommend using a `state_init.sh` script
written by the developer. This script should contain a list of txs using
the regen cli to initialize the desired state before the usage of the tesnet.